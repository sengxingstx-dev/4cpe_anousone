{% extends 'dashboard/base.html' %}
{% load static %}

{% block body %}
<div class="col-md-8 col-sm-5 col-xs-5">
  <div id="content" class="p-6 p-md-5 pt-5">
    <div class="col-md-12 col-sm-12 col-xs-10">
      <div class="card mb-3">
        <div class="card-header">
          <i class="fas fa-table text-primary"></i>
          <!-- Fill In Information Of Books -->
        </div>
        <div class="card-body">
          <form action="{% url 'aabook' %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
              <div class="col"><input type="text" class="form-control" name="title" placeholder="ຊື່ຫົວຂໍ້"
                  required="required"></div>
            </div>
            <!-- <div class="form-group">
              <div class="col"><input type="text" class="form-control" name="author" placeholder="Author"
                  value="{{ request.user.username }}" required="required"></div>
            </div> -->

            <!-- <div class="form-group">
              <div class="col"><input type="text" class="form-control" name="publisher" placeholder="Publisher"
                  value="{{ request.user.username }}" required="required"></div>
            </div> -->

            <div class="form-group">
              <div class="col"><input type="text" class="form-control" name="year" placeholder="ສົກສືກສາ"
                  required="required"></div>
            </div>

            <div class="form-group">
              <div class="col"><input type="text" class="form-control" name="desc" placeholder="ບົດຄັດຫຍໍ້"
                  required="required"></div>
            </div>

            <div class="form-group">
              <div class="col">
                <select id="majorDropdown" class="form-control" name="major" required>
                  <option value="" selected disabled>ເລືອກສາຂາ</option>
                  {% for major in majors %}
                  <option value="{{ major.id }}">{{ major }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
            
            <div class="form-group">
              <div class="col">
                <select id="teacherDropdown" class="form-control" name="teacher" required>
                  <option value="" selected disabled>ເລືອກອາຈານທີ່ປືກສາ</option>
                  {% for teacher in teachers %}
                  <option value="{{ teacher.id }}">{{ teacher }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
            
            <div class="form-group">
              <div class="col">
                <select id="studentDropdown" class="form-control" name="author" required>
                  <option value="" selected disabled>ຂຽນໂດຍ</option>
                </select>
              </div>
            </div>
            

            <div class="form-group">
              <div class="col"><label>ເລືອກຮູບໜ້າປົກ</label>
                <input type="file" id="myFile" name="cover" placeholder="Report Attachment"
                  enctype="multipart/form-data">
              </div>
            </div>

            <div class="form-group">
              <div class="col"><label>ເລືອກໄຟຣບົດ</label>
                <input type="file" id="myFile" name="pdf" placeholder="Report Attachment" enctype="multipart/form-data">
              </div>
            </div>

            <div class="form-group">
              <button type="submit" class="btn btn-primary btn-lg btn-block" href="">ເພີ່ມ</button>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>
</div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
  $('#majorDropdown').change(function() {
    var majorId = $(this).val();
    if (majorId) {
      $.ajax({
        url: '/get-teachers-students/',  // Update with your actual URL
        type: 'GET',
        data: { major_id: majorId },
        success: function(response) {
          // Clear previous options
          // $('#teacherDropdown').empty();
          $('#studentDropdown').empty();
          
          // Add new options
          // $.each(response.teachers, function(index, teacher) {
          //   $('#teacherDropdown').append('<option value="' + teacher.id + '">' + teacher.name + '</option>');
          // });
          $.each(response.students, function(index, student) {
            $('#studentDropdown').append('<option value="' + student.id + '">' + student.name + '</option>');
          });
        },
        error: function(xhr, status, error) {
          console.log(error);
        }
      });
    } else {
      // Clear options if no major selected
      // $('#teacherDropdown').empty();
      $('#studentDropdown').empty();
    }
  });
});

</script>

{% endblock %}